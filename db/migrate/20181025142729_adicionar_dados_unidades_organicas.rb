class AdicionarDadosUnidadesOrganicas < ActiveRecord::Migration[5.1]
  def change
    # eliminar relacionamentos
    Function.all.update_all(organic_unit_id: nil)
    Position.all.update_all(organic_unit_id: nil)

    OrganicUnitType.all.each do |e|
      e.destroy
    end

    p '*' * 200

    types = {u: OrganicUnitType.create(name: "Sub-Direcção"),
         d: OrganicUnitType.create(name: "Direcção"),
         s: OrganicUnitType.create(name: "Sector"),
         g: OrganicUnitType.create(name: "Gabinete"),
         r: OrganicUnitType.create(name: "Departamento")}

    OrganicUnit.all.each do |e|
      e.destroy
    end

    unidades_sem_dependencia = [
        ",GAD,Gabinete de Apoio e Dinamização Comercial",
        ",GAR,Gabinete de Arquivo e Documentação",
        ",GCC,Gabinete de Controlo Cambial",
        ",DJU,Direcção Jurídica",
        ",DPM,Direcção de Pequenas, Médias Empresas e Particulares",
        ",DGE,Direcção de Grandes Empresas e Particulares",
        ",DRC,Direcção de Risco",
        ",DCO,Direcção de Contabilidade",
        ",DFI,Direcção Financeira",
        ",DOP,Direcção de Operações",
        ",DPS,Direcção de Património e Serviços",
        ",DPE,Direcção de Pessoal",
        ",DDI,Direcção de Desenvolvimento Institucional",
        ",DPC,Direcção de Processamento e Controlo de Crédito",
        ",DMC,Direcção de Microcrédito",
        ",DTI,Direcção de Tecnologia e Sistemas de Informação",
        ",DMK,Direcção de Marketing e Comunicação",
        ",DGR,Direcção de Gestão e Recuperação de Crédito",
        ",DNI,Direcção de Desenvolvimento de Negócios Internacionais",
        ",DAI,Direcção de Auditoria Interna",
        ",DCP,Direcção de Compliance",
        ",DCE,Direcção de Risco de Crédito",
        ",DBE,Direcção de Banca Electronica",
        ",DBI,Direcção de Banca de Investimentos",
        ",DPB,Direcção de Private Banking",
        ",DTS,Direcção de Tesouraria",
        ",DSG,Direcção de Segurança",
        ",USI,Subdirecção de Sistemas de Informação",
        ",UTI,Subdirecção de Tecnologias de Informação"]

    unidades_sem_dependencia = unidades_sem_dependencia.map do |data|
      nothing, abbreviation, name = data.split(",")
      {name: name, abbreviation: abbreviation, organic_unit_type_id: types[abbreviation.to_s.first.downcase.to_sym]&.id}
    end

    p OrganicUnit.create(unidades_sem_dependencia).map{|e| p e.errors.messages}

    p '*' * 200

    unidades = [
        "GAD,RSE,Departamento de Seguros e Produtos Especializados",
        "GAD,RDC,Departamento de Dinamização Comercial",
        "GAR,RPD,Departamento de Preparação Documental",
        "GAR,RPR,Departamento de Processamento de Dados",
        "DCE,RAN,Departamento de Análise de Crédito",
        "DCE,RFE,Departamento de Financiamentos Estruturado Contratação",
        "DSG,RSF,Departamento de Segurança Física",
        "DSG,RSL,Departamento de Segurança Electrónica",
        "DSG,RSN,Departamento de Segurança da Informação",
        "DCO,ROP,Departamento Operacional",
        "DCO,RCG,Departamento de Controlo e Gestão",
        "DCO,RIG,Departamento de Informação de Gestão",
        "DRC,RRF,Departamento de Riscos Financeiros",
        "DRC,RRN,Departamento de Riscos Não Financeiros",
        "DFI,RSM,Departamento da Sala de Mercados",
        "DFI,RCR,Departamento de Controlo Financeiro e Risco",
        "DOP,RON,Departamento de Operações Nacionais",
        "DOP,ROE,Departamento de Operações de Estrangeiro",
        "DOP,RMT,Departamento de Manutenção de Contas",
        "DOP,RCO,Departamento de Controlo Operacional",
        "DPS,RGO,Departamento de Gestão de Projectos de Obras",
        "DPS,RTE,Departamento de Transporte",
        "DPS,RSV,Departamento de Serviços",
        "DPS,RES,Departamento de Manutenção de Balcões, Controlo e Supervisão",
        "DPS,RPA,Departamento de Património",
        "DPE,RRS,Departamento de Recrutamento e Selecção",
        "DPE,RGP,Departamento de Gestão e Processamento",
        "DPE,RFD,Departamento de Formação e Desenvolvimento do Capital Humano",
        "DDI,ROG,Departamento Organizacional",
        "DDI,RQL,Departamento de Qualidade",
        "DMC,RAM,Departamento de Análise e Monitorização",
        "DMC,RPO,Departamento de Processamento e Operações",
        "DTI,RSI,Departamento de Sistemas",
        "DTI,RRC,Departamento de Redes e Comunicações",
        "DTI,RAP,Departamento de Apoio a Utilizadores",
        "DTI,RDS,Departamento de Desenvolvimentode sistemas Aplicacionais",
        "DTI,RIM,Departamento de Instalação de Manutenção de Equipamento Informático",
        "DTI,ROS,Departamento de Operação de Sistemas Centrais",
        "DTI,RGT,Departamento de Gestão de Projectos de Tecnologias de Informação",
        "DGE,RCE,Centros",
        "DGR,RRE,Departamento de Recuperação de Crédito",
        "DGR,RRI,Departamento de Recuperação de Microcrédito",
        "DJU,RAJ,Departamento de Assessoria Juridica",
        "DJU,RCN,Departamento de Contencioso",
        "DMK,RPC,Departamento de Provedoria de Cliente",
        "DMK,RMK,Departamento de Marketing",
        "DBE,RPS,Departamento de Produtos e Serviços",
        "DBE,RAC,Departamento de Aceitação",
        "DBE,RCF,Departamento de Controlo e Fraude",
        "DAI,RAB,Departamento de Auditoria aos Balcões",
        "DAI,RAS,Departamento de Auditoria aos Serviços Centrais",
        "DAI,RAU,Departamento de Auditoria Remota",
        "DTS,RCU,Departamento de Controlo de Numerário",
        "DTS,RCP,Departamento de Contagem e Pagamentos",
        "DCP,RFO,Departamento de Conformidade",
        "DCP,RPB,Departamento de Prevenção de Branqueamento de Capitais",
        "DPM,RBA,Departamento de Balcões",
        "DPE,SAS,Sector de Apoio Social",
        "DPS,SCO,Sector de Correspondência",
        "DPS,SME,Sector de Manutenção do Edifício Sede",
        "DPS,SCM,Sector de Compras",
        "DPS,SHL,Sector de Higiene e Limpeza",
        "DPS,STR,Sector de Transporte",
        "DPS,SEO,Sector de Economato",
        "DTI,SIE,Sector de Instalação de Equipamento Informático",
        "DTI,SMI,Sector de Manutenção de Equipamento Informático",
        "DTI,SSE,Sector de Stock de Equipamento",
        "DBE,SCG,Sector de Gestão de Ciclo",
        "DBE,SCA,Sector de Cartões",
        "DBE,SSP,Sector de Soluções de Pagamento",
        "DBE,SRG,Sector de Regularizações",
        "DBE,SIF,Sector de Investigação e Fraudes",
        "DMK,SCL,Sector de Call Center",
        "DMK,SPR,Sector de Protocolo e Relações Públicas",
        "DOP,SCP,Sector de Compensação",
        "DOP,STN,Sector de Transferências",
        "DOP,SPG,Sector de Pagamentos",
        "DOP,SCD,Sector de Créditos Documentários de Importação",
        "DOP,SRC,Sector de Reconciliações",
        "DOP,SCN,Sector de Controlo Operacional"
    ]

    parents = OrganicUnit.all.index_by(&:abbreviation)
    unidades = unidades.map do |data|
      parent, abbreviation, name = data.split(",")
      {name: name, abbreviation: abbreviation, organic_unit_id: parents[parent]&.id, organic_unit_type_id: types[abbreviation.first.downcase.to_sym]&.id}
    end
    p OrganicUnit.create(unidades).map{|e| p e.errors.messages}

  # cricao de balcoes
  Establishment.all.each do |e|
    e.destroy
  end

  EstablishmentType.all.each do |e|
    e.destroy
  end


  p '*' * 200
  balcoes = ["NCA,Agência de Caxito,701,BENGO,CAXITO,03/10/2001,5,25,José Peliganga",
           "IAM,Dependência do Ambriz,702,BENGO,AMBRIZ,31/03/2008,1,8,Dombel Lando",
           "PFA,Posto da Repartição Fiscal do Ambriz,703,BENGO,AMBRIZ,12/02/2009,2,,Dombel Lando",
           "PSX,Posto do SIAC de Caxito,704,BENGO,CAXITO,21/10/2014,,10,José Peliganga",
           "IPN,Dependência do Panguila,705,BENGO,CAXITO,07/08/2015,1,36,Lelia Costa",
           "NLB,Agência do Lobito,1101,BENGUELA,LOBITO,29/07/2005,3,54,Carina Marques",
           "PLA,Posto da Alfândega do Lobito,1150,BENGUELA,LOBITO,11/02/2005,,7,Edna Clemente",
           "NBE,Agência de Benguela,1102,BENGUELA,BENGUELA,28/09/2007,3,44,Tatiana Rodrigues",
           "ICU,Dependência do Cubal,1103,BENGUELA,CUBAL,07/10/2008,1,9,Domingos Nordes",
           "ICB,Dependência Caminho de Ferro de Benguela,1104,BENGUELA,LOBITO,19/03/2010,1,25,Núria da Cruz",
           "PML,Posto da Maxi Lobito,1105,BENGUELA,LOBITO,05/07/2010,1,,",
           "IMM,Dependência do Mercado Municipal do Lobito,1106,BENGUELA,LOBITO,30/09/2010,2,32,Arsénio Pinto",
           "IBV,Dependência da Bela Vista,1107,BENGUELA,LOBITO,28/01/2011,2,34,Edine da Costa",
           "PSB,Posto do Siac de Benguela,1108,BENGUELA,BENGUELA,28/11/2011,1,10,Eliseu António",
           "IHC,Dependência do Hospital Central de Benguela,1109,BENGUELA,BENGUELA,30/05/2012,2,26,Edson Fernandes",
           "PCB,Posto do CLESE de Benguela,1111,BENGUELA,BENGUELA,30/05/2013,,,Tatiana Rodrigues",
           "ILO,Dependência do Porto do Lobito,1112,BENGUELA,LOBITO,24/01/2014,1,15,Nimy Luis",
           "PAA,Posto do Aeroporto da Catumbela,1113,BENGUELA,LOBITO,17/06/2014,,,Tatiana Rodrigues",
           "ILI,Dependência do Liro,1114,BENGUELA,LOBITO,13/12/2017,3,10,Manuel Macedo",
           "PUC,Posto da Unicargas da Catumbela,1115,BENGUELA,LOBITO,14/08/2017,1,,",
           "IGA,Dependência da Ganda,1110,BENGUELA,BENGUELA,16/02/2018,2,4,Baptista Cungomalã",
           "CELO,Centro de Empresas – Lobito,2015,BENGUELA,LOBITO,14/08/2017,,30,Elsa Santos",
           "NKT,Agência do Kuíto,1301,BIÉ,KUÍTO,29/10/2004,2,30,Romeu Cangombe",
           "PKU,Posto do Kunge,1302,BIÉ,KUÍTO,16/03/2011,1,3,Romeu Cangombe",
           "PCH,Posto do Chinguar,1303,BIÉ,KUÍTO,29/08/2012,1,19,Tiago Fernando",
           "NCD,Agência de Cabinda,101,CABINDA,CABINDA,31/08/2006,1,45,Preciosa Barata",
           "ICD,Dependência de Cabinda,103,CABINDA,CABINDA,15/05/2009,1,39,Cassoma Filipe",
           "PAC,Posto da Alfândega de Cabinda (Porto),102,CABINDA,CABINDA,07/04/2006,1,17,Gizela António",
           "PAM,Posto da Alfândega de Massabi,104,CABINDA,KACONGO,23/10/2007,,15,Manuel Nzau",
           "PAL,Posto da Alfândega de Landâna,105,CABINDA,KACONGO,07/04/2006,1,19,Lídia Zuzi",
           "PAO,Posto da Alfândega de Malongo,106,CABINDA,CABINDA,07/04/2006,2,1,",
           "PCA,Posto da Alf. do Aeroporto (Cabinda),107,CABINDA,CABINDA,07/04/2006,,,Cassoma Filipe",
           "PAY,Posto da Alfândega do Yema,108,CABINDA,CABINDA,10/08/2010,2,,Cassoma Filipe",
           "PSD,Posto do Siac de Cabinda,109,CABINDA,CABINDA,07/03/2013,1,12,Virginia Mangovo",
           "PCC,Posto do CLESE de Cabinda,111,CABINDA,CABINDA,18/05/2015,,,",
           "IFT,Dependência de Fútila,110,CABINDA,CABINDA,11/03/2016,2,14,Maria Domingos",
           "CECA,Centro de Empresas – Cabinda,2018,CABINDA,CABINDA,02/10/2017,,16,José Ruben",
           "NHB,Agência do Huambo,1201,HUAMBO,HUAMBO,04/04/2006,6,87,Rosália N´djaka",
           "IBA,Dependência do Bailundo,1202,HUAMBO,HUAMBO,13/03/2009,1,29,Henriques Graça",
           "PQI,Posto da Quissala,1203,HUAMBO,HUAMBO,16/06/2010,1,41,Yuri Maria",
           "ICI,Dependência da Cidade Alta (Huambo),1205,HUAMBO,HUAMBO,15/03/2011,3,40,Ernesto Faustino",
           "PSH,Posto do Siac do Huambo,1204,HUAMBO,HUAMBO,30/03/2012,,21,Olga Tadeu",
           "PCL,Posto do CLESE do Huambo,1206,HUAMBO,HUAMBO,25/08/2012,,1,Rosália N´djaka",
           "NHA,Agência da Huíla (Lubango),1501, HUÍLA,LUBANGO,06/07/2007,1,33,Elizeth Fernando",
           "ILU,Dependência do Lubango,1503, HUÍLA,LUBANGO,13/11/2007,2,21,Cindhia Duarte",
           "IMU,Dependência do Mercado do Mutundo,1504, HUÍLA,LUBANGO,13/06/2012,2,11,Amada Abraão",
           "IQP,Dependência do Quipungo,1505, HUÍLA,LUBANGO,15/05/2013,3,4,Clésio do Rosário",
           "PCI,Posto CLESE da Huila,1506, HUÍLA,LUBANGO,28/05/2015,,,Elizeth Fernando",
           "CERH,Centro de Empresas - Região Sul (Huíla),2010, HUÍLA,HUÍLA,05/08/2015,,14,Rudy Sousa",
           "NQI,Agência da Quibala,601,KWANZA SUL,QUIBALA,21/11/2008,2,27,Evaristo Baptista",
           "IWK,Dependência do Waku Kungo,602,KWANZA SUL,WAKU KUNGO,18/11/2009,2,16,Sérgio Fortes",
           "PPA,Posto da Alfândega do Porto Amboim,603,KWANZA SUL,PORTO AMBOIM,15/10/2010,1,12,Evando Teixeira",
           "IMS,Dependência do Mercado do Sumbe,604,KWANZA SUL,KWANZA SUL,05/07/2012,2,39,Yvanilson Pereira",
           "PCS,Posto CLESE do Sumbe,605,KWANZA SUL,KWANZA SUL,23/11/2012,,1,Yvanilson Pereira",
           "ISU,Dependência do Sumbe,606,KWANZA SUL,KWANZA SUL,18/04/2013,2,34,Edson José",
           "IPA,Dependência do Porto Amboim,607,KWANZA SUL,PORTO AMBOIM,09/12/2015,4,19,Evando Teixeira",
           "NES,Agência Edifício Sol,520,LUANDA,LUANDA,02/12/2010,3,149,Edilásio Jorge",
           "IKA,Dependência da Katyavala,501,LUANDA,LUANDA,02/10/2001,4,170,Natacha Matamba",
           "IMT,Dependência da Mutamba,502,LUANDA,LUANDA,02/10/2001,4,23,Sandra Cabral",
           "ICA,Dependência do Cazenga,503,LUANDA,CAZENGA,13/07/2003,1,77,Ruth Ernesto",
           "IAL,Dependência Alfândega de Luanda,5003,LUANDA,LUANDA,14/07/2003,,,Hotchay Pereira",
           "IPL,Dependência do Porto de Luanda,5006,LUANDA,LUANDA,03/09/2004,1,,Jay Pascoal",
           "ICR,Dependência do Cruzeiro,504,LUANDA,LUANDA,15/04/2005,,175,Celma Eduardo",
           "IBP,Dependência do Bairro Popular,505,LUANDA,LUANDA,07/07/2005,2,211,Yomara Neto",
           "ISP,Dependência do São Paulo,506,LUANDA,LUANDA,18/11/2005,,,",
           "IEC,Dependência do Entreposto Aduaneiro,5008,LUANDA,LUANDA,14/07/2006,,28,Amélia Garcia",
           "IAC,Dependência de Amílcar Cabral,507,LUANDA,LUANDA,16/08/2006,4,81,Keylah Guedes",
           "IMB,Dependência do Morro Bento,508,LUANDA,TALATONA,01/12/2006,1,12,",
           "IAB,Dependência do Américo Boavida,509,LUANDA,LUANDA,13/04/2007,2,93,Gisela Machado",
           "IHM,Dependência do Hospital Militar,510,LUANDA,LUANDA,18/12/2007,2,90,Bruno Silva",
           "IBJ,Dependência do Bom Jesus,5010,LUANDA,BOM JESUS,17/03/2008,2,15,Afonsino Abreu",
           "ILA,Dependência da Liga Africana,511,LUANDA,LUANDA,16/07/2008,8,92,Lalice Chiwayenge",
           "IRG,Dependência da Rainha Ginga,513,LUANDA,LUANDA,18/07/2008,5,35,Claúdio Costa",
           "ICC,Dependência de Cacuaco,512,LUANDA,CACUACO,29/08/2008,5,89,Maria Messani",
           "IVI,Dependência de Viana,514,LUANDA,VIANA,14/11/2008,3,128,Vladimir Monteiro",
           "IMC,Dependência do Maculusso,515,LUANDA,LUANDA,05/10/2009,2,61,Aquitânia André",
           "IMO,Dependência do Morro Bento II,517,LUANDA,TALATONA,18/12/2009,9,183,Denise Van Dúnem",
           "IMA,Dependência do Marçal,516,LUANDA,LUANDA,12/03/2010,3,152,Fernandes Antonio",
           "IUC,Dependência da Cuca,518,LUANDA,CAZENGA,11/06/2010,5,68,Sofia Cassule",
           "IUA,Dependência da Utanga,519,LUANDA,LUANDA,28/10/2010,2,73,Nimi Simbi",
           "IGS,Dependência do Ginga Shopping,521,LUANDA,VIANA,30/06/2011,2,56,Aurio Quicunga",
           "ICE,Dependência Edel do Camama,522,LUANDA,TALATONA,27/04/2011,1,80,Sandra Kavulamine",
           "IBF,Dependência do Benfica,526,LUANDA,TALATONA,13/07/2012,3,103,Yolanda Vinhas",
           "IFU,Dependência do Futungo,527,LUANDA,LUANDA,13/07/2012,2,97,Ana André",
           "ISB,Dependência da Samba,528,LUANDA,LUANDA,13/07/2012,,77,Catarina Nobre",
           "ITH,Dependência do Tala Hady,525,LUANDA,CAZENGA,03/08/2012,2,134,Lurdes Bernardo",
           "IFE,Dependência do Ferrovia,524,LUANDA,LUANDA,01/11/2012,6,93,Cleusia Piedade",
           "IGL,Dependência da Marginal,530,LUANDA,LUANDA,01/11/2012,5,144,Antónia do Vale",
           "IZG,Dependência do Zango,5015,LUANDA,VIANA,18/12/2012,2,102,Victor Azevedo",
           "IVF,Dependência Vereda das Flores,533,LUANDA,KILAMBA KIAXI,06/09/2013,2,167,Neusa Inácio",
           "IUT,Dependência da Mutamba II,529,LUANDA,LUANDA,16/09/2013,2,152,Edcina Lua",
           "IDR,Dependência da Avenida Deolinda Rodrigues,523,LUANDA,LUANDA,02/10/2013,2,96,Ana de Carvalho",
           "IJR,Dependência Jardim de Rosas,537,LUANDA,LUANDA,23/12/2013,1,110,Esmeralda Manecas",
           "IET,Dependência do Edifício Talatona,536,LUANDA,TALATONA,17/03/2014,2,70,Nércia Neto",
           "INV,Dependência do Nova Vida,538,LUANDA,KILAMBA KIAXI,23/06/2014,8,91,Rosália Lourinho",
           "IBE,Dependência do Benfica II,532,LUANDA,TALATONA,12/12/2014,6,112,Delcio da Silva",
           "ISO,Dependência Soba Capassa (Camama) ,535,LUANDA,LUANDA,12/12/2014,5,83,Celestino da Costa",
           "IUL,Dependência do Centro Comercial Ulengo da SAPÚ,540,LUANDA,KILAMBA KIAXI,18/12/2014,2,88,Aguinalda Semedo",
           "IGO,Dependência do Golf II,539,LUANDA,LUANDA,19/12/2014,2,93,Constância Paulo",
           "IKB,Dependência do Kaop Business Park,542,LUANDA,CACUACO,19/06/2015,2,20,",
           "ISI,Dependência do Simione (Camama) ,534,LUANDA,LUANDA,02/10/2015,5,67,Rossana Mikia",
           "IAH,Dependência Avenida Hojy-Ya-Henda,544,LUANDA,LUANDA,13/11/2015,2,55,António de Jesus",
           "IWC,Dependência do Complexo WTC,545,LUANDA,VIANA,13/11/2015,3,87,Danilson Santana",
           "IPM,Dependência do Projecto Morar,546,LUANDA,VIANA,25/05/2016,2,119,Constância da Costa",
           "IGK,Dependência do Gamek,541,LUANDA,KILAMBA KIAXI,01/07/2016,2,32,Bruno Ramos",
           "ILP,Dependência do Lar Patriota,531,LUANDA,BELAS,16/09/2016,5,60,Matilde Domingos",
           "ICV,Dependência do Condominio Bela Vista,547,LUANDA,BENFICA,18/11/2016,3,25,Manuelina Correia",
           "ICN,Dependência do Cacuaco Business Park,543,LUANDA,CACUACO,09/12/2016,7,71,Joaquim Lima",
           "IVN,Dependência do Condomínio Vila Nova (Talatona) ,549,LUANDA,TALATONA,18/08/2017,3,31,Dalva da Paixão",
           "ICK,Dependência da Cidade do Kilamba ,550,LUANDA,KILAMBA ,02/10/2017,4,50,Julio Fernandes",
           "IVA,Dependência da Vila Alice,555,LUANDA,LUANDA ,15/06/2018,3,11,Manuela El Bechouti",
           "IKI,Dependência do Kifica (C.C Dois Amores),551,LUANDA,LUANDA,01/12/2017,3,35,Cláudio Francisco",
           "PMA,Posto da Martal,5002,LUANDA,LUANDA,09/01/2003,,,Demétrio Manjenje",
           "PJE-IV,Posto das Jembas IV (Viana),5005,LUANDA,VIANA,10/09/2004,2,43,",
           "PJE-V,Posto das Jembas V (Atlântico),5007,LUANDA,LUANDA,05/11/2004,,,",
           "PMX,Posto da Maxi,5012,LUANDA,LUANDA,05/11/2007,,,",
           "PPS,Posto do Porto Seco,5016,LUANDA,VIANA,01/02/2010,2,31,Mariano Alfredo",
           "PMM,Posto do Miramar,5018,LUANDA,LUANDA,20/12/2010,1,63,Márcia Quintino",
           "PHL,Posto da DHL (Sagrada Familia),5017,LUANDA,LUANDA,03/01/2011,,,Edilásio Jorge",
           "PSZ,Posto do SIAC do Zango,5019,LUANDA,VIANA,24/06/2011,,17,Victor Azevedo",
           "PSA,Posto do SIAC do Cazenga,5020,LUANDA,CAZENGA,01/12/2011,,27,Ruth Ernesto",
           "PCQ,Posto do Cassequel,5022,LUANDA,LUANDA,13/07/2012,,,",
           "PZE,Posto da Zona Económica Especial,5024,LUANDA,VIANA,12/10/2012,1,76,Mirta Wilson",
           "PLP,Posto da Maternidade Lucrécia Paim,5023,LUANDA,LUANDA,29/07/2013,1,47,",
           "PEN,Posto da ENANA,5025,LUANDA,LUANDA,10/07/2013,1,1,Jay Pascoal",
           "PST,Posto do SIAC do Talatona,5026,LUANDA,TALATONA,16/09/2013,1,25,Armando Calei",
           "PCP,Posto Cais do Porto de Luanda,5027,LUANDA,LUANDA,03/04/2014,2,32,Samira Pole",
           "PSC,Posto do SIAC de Cacuaco,5028,LUANDA,CACUACO,01/12/2015,1,13,Angélica da Fonseca",
           "PCK,Posto do CLESE do Kilamba,5029,LUANDA,BELAS,20/05/2016,2,73,Artemiza de Sousa",
           "PAK,Posto da Aldeia de Kaxicane,5030,LUANDA,KAXICANE,17/06/2016,1,,Euclides Jorge",
           "PAD,Posto da Africana Discount ,5032,LUANDA,LUANDA,15/06/2018,5,5,Potenciana Samuel",
           "PCF,Posto do CLESE do Golf,5031,LUANDA,KILAMBA KIAXI,15/11/2016,1,64,Yomara Neto",
           "CEES,Centro de Empresas – Edifício Sol,2001,LUANDA,LUANDA,02/12/2010,,116,Katia Cursino",
           "CELA,Centro de Empresas – Liga Africana,2002,LUANDA,LUANDA,02/10/2008,,75,Alpouk Yaba",
           "CEMB,Centro de Empresas – Edifício do Talatona,2003,LUANDA,TALATONA,27/07/2009,,59,Conceição Cirilo",
           "CEMT,Centro de Empresas – Mutamba,2004,LUANDA,LUANDA,23/02/2010,,61,Nárcia Cassoma",
           "CEFE,Centro de Empresas – Ferrovia,2005,LUANDA,LUANDA,01/11/2012,,107,Yahara Nascimento",
           "CEMI,Centro de Empresas – Missão,2006,LUANDA,LUANDA,09/09/2013,,135,Ana Carla João",
           "CEGL,Centro de Empresas – Marginal,2007,LUANDA,LUANDA,01/11/2012,,79,Emanuel Nguenge",
           "CEOG,Centro de Empresas – OIL e GAZ,2008,LUANDA,LUANDA,07/05/2013,,66,Libânia Costa",
           "CEDR,Centro de Empresas – Av. Deolinda Rodrigues,2009,LUANDA,LUANDA,02/10/2013,,146,Rosa da Conceição",
           "CEVI,Centro de Empresas - Viana,2011,LUANDA,VIANA,24/03/2014,,96,Kátia Fonseca",
           "CEBE,Centro de Empresas - Benfica II,2012,LUANDA,TALATONA,12/12/2014,,76,Beatriz dos Reis",
           "CESO,Centro de Empresas - Soba Capassa (Talatona),2013,LUANDA,LUANDA,12/12/2014,,93,Ligia Miguel",
           "CELP,Centro de Empresas - Lar do Patriota,2014,LUANDA,TALATONA,16/09/2016,,138,Abel Francisco",
           "CECB,Centro de Empresas – Cacuaco Business Park,2017,LUANDA,CACUACO,09/12/2016,,89,Sérgio Frutuoso",
           "CEVA,Centro de Empresas – Vila Alice ,2020,LUANDA,LUANDA ,15/06/2018,,7,Maria da Graça Costa",
           "CPBA,Centro Private – Alvalade,4001,LUANDA,LUANDA,10/07/2017,,3,Albertina Cerca",
           "IPL,Caixa Avançado do Terminal da Unicarga (Unicarga),5006,LUANDA,LUANDA,29/04/2009,,,",
           "IAL,Caixa Avançado do Terminal SAL (Luanda),5003,LUANDA,LUANDA,01/06/2008,,,Hotchay Pereira",
           "IAL,Caixa Avançado do Terminal  Alf. Aeroporto (Luanda),5003,LUANDA,LUANDA,04/05/2007,,,",
           "IAL,Caixa Avançado - TECA 2,5003,LUANDA,LUANDA,,,,",
           "ICA,Caixa Avançado da Fermat - Palanca,503,LUANDA,CAZENGA,27/04/2009,,,Ruth Ernesto",
           ",Caixa Avançado do Aeroporto de Luanda (Placa),,LUANDA,LUANDA,18/10/2010,,,",
           "IBP,Caixa Avançado da Loja dos Registos ( B. Popular),505,LUANDA,KILAMBA KIAXI,,,,Yomara Neto",
           "ISP,Caixa Avançado do 4ª Cartório (São Paulo),506,LUANDA,SAMBIZANGA,20/02/2012,,,",
           "IUA,Caixa Avançado da 5ª Conservatória ( Palanca),519,LUANDA,CAZENGA,,,,Nimi Simbi",
           "ICC,Caixa Avançado da Loja dos Registos (Cacuaco),512,LUANDA,CACUACO,26/05/2014,,,Maria Messani",
           "IVI,Caixa Avançado da Loja dos Registos (Viana),514,LUANDA,VIANA,02/07/2014,,,Vladimir Monteiro",
           "ICE,Caixa Avançado da Loja dos Registos (Talatona),522,LUANDA,TALATONA,02/07/2014,,,Sandra Kavulamine",
           "ISP,Caixa Avançado da Embaixada do Brasil,506,LUANDA,LUANDA,04/01/2016,,,",
           "IAC,Caixa Avançado da Chevron,507,LUANDA,LUANDA,18/01/2016,,,Keylah Guedes",
           "ILA,Atendimento Automático – Liga Africana,511,LUANDA,LUANDA,02/10/2008,,,Lalice Chiwayenge",
           "IPL,Atendimento Automático – Ferrovia,524,LUANDA,LUANDA,,,,Cleusia Piedade",
           "ICC,Atendimento Automático - Cacuaco,512,LUANDA,LUANDA,12/07/2012,,,Maria Messani",
           "IUC,Atendimento Automático - Cuca,518,LUANDA,LUANDA,12/07/2012,,,Sofia Cassule",
           "INV,Atendimento Automático - Nova Vida,538,LUANDA,LUANDA,23/06/2014,,,Rosália Lourinho",
           "IBE,Atendimento Automático -  Benfica II,532,LUANDA,BELAS,12/12/2014,,,Delcio da Silva",
           "ISI,Atendimento Automático - Simione (Camama) ,534,LUANDA,LUANDA,02/10/2015,,,Rossana Mikia",
           "ILP,Atendimento Automático - Lar Patriota,531,LUANDA,LUANDA,16/09/2016,,,Matilde Domingos",
           "ICN,Atendimento Automático - Sequele,543,LUANDA,LUANDA,02/10/2017,,,Mariano Machado",
           "NMA,Agência de Malanje,1901,MALANJE,MALANJE,03/11/2003,5,44,Madalena Cambando",
           "ICS,Dependência de Cacuso,1902,MALANJE,MALANJE,16/12/2009,6,16,João Gomes",
           "IMG,Dependência de Malange,1903,MALANJE,MALANJE,30/09/2010,4,57,Yolanda de Jesus",
           "PSM,Posto do SIAC de Malanje,1904,MALANJE,MALANGE,29/01/2011,,3,Mário Jacinto",
           "PMG,Posto do Mercado Municipal de Malanje,1906,MALANJE,MALANGE,13/07/2012,2,26,Lino Dala",
           "PCG,Posto do CLESE de Malange,1907,MALANJE,MALANGE,10/03/2014,,,Madalena Cambando",
           "IMN,Dependência do Massango,1908,MALANJE,MALANJE,27/05/2016,2,8,Timóteo de Melo",
           "NUI,Agência do Uíge,201,UÍGE,UÍGE,27/06/2013,6,78,Edgar da Silva",
           "PFU,Posto da Repartição Fiscal do Uíge,202,UÍGE,UÍGE,05/05/2010,,1,Edgar da Silva",
           "PSU,Posto do SIAC do Uíge,203,UÍGE,UÍGE,06/07/2011,,,Edgar da Silva",
           "INE,Dependência do Negage,204,UÍGE,UÍGE,17/05/2013,2,25,César Filipe",
           "PCU,Posto do CLESE do Uíge,205,UÍGE,UÍGE,03/10/2013,,,Edgar da Silva",
           "PIU,Posto do ISCED do Uíge,206,UÍGE,UIGE,31/10/2014,2,14,Bonifácio João",
           "PPJ,Posto do Palácio da Justiça do Uíge,207,UÍGE,UIGE,31/10/2014,4,16,Paulina Caquila",
           "NSO,Agência do Soyo,301,ZAIRE,SOYO,17/04/2009,2,34,Gaspar Mingongo",
           "INZ,Dependência do Nzeto,303,ZAIRE,NZETO,13/11/2015,2,70,André Jorgina",
           "IIM,Dependência do INSS do Mbanza Congo,304,ZAIRE,SOYO,30/01/2015,2,73,João Joana",
           "PAS,Posto da Alfândega do Soyo,3002,ZAIRE,SOYO,24/03/2005,,24,Alcina Gonçalves",
           "PUI,Posto da Alfândega do  Catuite,1701,KUANDO KUBANGO,K - KUBANGO,05/07/2010,,,Wilson Ferreira",
           "NMG,Agência de Menongue,1702,KUANDO KUBANGO,MENONGUE,01/09/2015,2,84,Dario Fortes",
           "NON,Agência Ondjiva,1801,CUNENE,CUNENE,24/08/2012,2,64,Manuel Campos",
           "ISC,Dependência de  Santa Clara,1802,CUNENE,SANTA CLARA,30/09/2010,2,10,José Sakulanda",
           "PSO,Posto do SIAC de Ondjiva,1803,CUNENE,ONDJIVA,01/02/2017,1,1,Manuel Campos",
           "ISC,Caixa Avançado da Alfândega da Santa Clara,1802,CUNENE,CUNENE,27/08/2012,,,",
           "NMB,Agência do Namibe,1601,NAMIBE,NAMIBE,13/06/2011,1,28,Mateus da Silva",
           "PMN,Posto do Mercado Municipal do Namibe,1602,NAMIBE,NAMIBE,23/08/2013,1,18,Jandira Dala",
           "NND,Agência de N'dalatando,401,KWANZA NORTE,N'DALATANDO,04/11/2011,2,45,Ceidina Inácio",
           "IDO,Dependência do Dondo,402,KWANZA NORTE,DONDO,29/11/2013,3,38,Manuel Francisco",
           "ICT,Dependência de Camabatela,403,KWANZA NORTE,CAMABATELA,20/06/2014,3,15,João Manuel",
           "PCN,Posto do CLESE do Kwanza Norte,404,KWANZA NORTE,N'DALATANDO,22/07/2014,,,",
           "PLU,Posto do Laúca,405,KWANZA NORTE,LAÚCA,20/04/2015,,,João Gomes",
           "NMX,Agência do Móxico,1401,MOXICO,LUENA,29/11/2012,4,47,Rachete Muhongo",
           "PCM,Posto do CLESE do Moxico,1402,MOXICO,LUENA,03/02/2014,,2,Rachete Muhongo",
           "ILE,Dependência do Luena,1403,MOXICO,LUENA,17/02/2017,2,41,",
           "NDU,Agência do Dundo,801,LUNDA NORTE,DUNDO,01/11/2012,4,72,Eduardo Machado",
           "PCO,Posto do CLESE do Dundo,802,LUNDA NORTE,DUNDO,15/06/2015,,,Eduardo Machado",
           "NSA,Agência do Saurimo,901,LUNDA SUL,SAURIMO,02/10/2014,2,53,Antónia Manuel",
           "PMS,Posto do Mercado Municipal do Saurimo,902,LUNDA SUL,SAURIMO,12/10/2012,2,27,Antónia Manuel",
           "PSS,Posto do SIAC do Saurimo,903,LUNDA SUL,SAURIMO,24/10/2013,,9,Antónia Manuel"]

    municipalities = Municipality.includes(:province).index_by{|m| [m.province.name.upcase, m.name.upcase]}

    balcoes = balcoes.map do |data|
      abbreviation, name, code, province, municipality, inaugurated_at, atm_count, tpa_count, responsible = data.split(",")
      {
        abbreviation: abbreviation,
        name: name,
        code: code,
        municipality_id: municipalities[[province.upcase, municipality.upcase]]&.id,
        inaugurated_at: inaugurated_at,
        atm_count: atm_count,
        tpa_count: tpa_count
      }
    end

    # vai agrupar os balcoes em um hash onde a chave é o primeiro no do balcão {"AGENCIA" => [de agencias], "Posto" => [de postos] etc}
  	balcoes.group_by{|x| x[:name].split(" ").first.upcase}.each do |balcao, balcoes_do_tipo|
  		# vai criar um tipo para
  		tipo = EstablishmentType.create(name: balcao)
      balcoes_do_tipo = balcoes_do_tipo.map { |e| e.merge!(establishment_type_id: tipo.id) }
  		p Establishment.create(balcoes_do_tipo).map{|e| p e.errors.messages}
  	end

  end
end
